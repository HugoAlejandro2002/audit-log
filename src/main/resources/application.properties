# =========================
# Datasource (MySQL)
# =========================
quarkus.datasource.db-kind=mysql
quarkus.datasource.username=${DB_USER}
quarkus.datasource.password=${DB_PASSWORD}

quarkus.datasource.jdbc.url=jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
quarkus.datasource.jdbc.max-size=${DB_POOL_MAX_SIZE:20}
quarkus.datasource.jdbc.min-size=${DB_POOL_MIN_SIZE:2}
quarkus.datasource.jdbc.acquisition-timeout=${DB_POOL_ACQUIRE_TIMEOUT:10S}
quarkus.datasource.jdbc.idle-removal-interval=${DB_POOL_IDLE_REMOVAL:5M}

# =========================
# Hibernate ORM
# =========================
quarkus.hibernate-orm.log.sql=${HIBERNATE_SQL_LOGS:false}
quarkus.hibernate-orm.schema-management.strategy=${HIBERNATE_SCHEMA_STRATEGY:validate}

# =========================
# HTTP / Cloud Run
# =========================
quarkus.http.port=${PORT:8080}
quarkus.http.host=0.0.0.0

# =========================
# CORS config
# =========================
quarkus.http.cors.enabled=${CORS_ENABLED:false}
quarkus.http.cors.origins=${CORS_ORIGINS:*}
quarkus.http.cors.headers=${CORS_HEADERS:accept,authorization,content-type,x-request-id,x-actor-id}
quarkus.http.cors.methods=${CORS_METHODS:GET,POST,PUT,DELETE,PATCH,OPTIONS}

# =========================
# Swagger / OpenAPI
# =========================
quarkus.swagger-ui.enabled=true
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger
quarkus.smallrye-openapi.path=/openapi
quarkus.swagger-ui.title=Audit Log API
quarkus.swagger-ui.theme=material
quarkus.swagger-ui.footer=Audit Log - v1
quarkus.swagger-ui.deep-linking=true
quarkus.swagger-ui.display-request-duration=true
quarkus.swagger-ui.doc-expansion=list
quarkus.swagger-ui.filter=true
quarkus.swagger-ui.tags-sorter=alpha
quarkus.swagger-ui.operations-sorter=alpha

# =========================
# Security for docs (Basic Auth)
# =========================
quarkus.http.auth.basic=true
quarkus.security.users.file.enabled=true
quarkus.security.users.file.plain-text=true
# Use external files via env if available; fallback to classpath files
quarkus.security.users.file.users=${USERS_FILE_PATH:users.properties}
quarkus.security.users.file.roles=${ROLES_FILE_PATH:roles.properties}

# Protect Swagger UI and OpenAPI on both plain and non-app root paths
quarkus.http.auth.permission.swagger.paths=/swagger/*
quarkus.http.auth.permission.swagger.policy=authenticated
quarkus.http.auth.permission.swagger2.paths=/swagger
quarkus.http.auth.permission.swagger2.policy=authenticated
quarkus.http.auth.permission.openapi.paths=/openapi
quarkus.http.auth.permission.openapi.policy=authenticated
quarkus.http.auth.permission.openapi2.paths=/openapi/*
quarkus.http.auth.permission.openapi2.policy=authenticated
# Non-application root path (default /q) variants
quarkus.http.auth.permission.swaggerq.paths=/q/swagger/*
quarkus.http.auth.permission.swaggerq.policy=authenticated
quarkus.http.auth.permission.swaggerq2.paths=/q/swagger
quarkus.http.auth.permission.swaggerq2.policy=authenticated
quarkus.http.auth.permission.openapiq.paths=/q/openapi
quarkus.http.auth.permission.openapiq.policy=authenticated
quarkus.http.auth.permission.openapiq2.paths=/q/openapi/*
quarkus.http.auth.permission.openapiq2.policy=authenticated
# Protect the /openapi.json endpoint
quarkus.http.auth.permission.openapiq.paths=/openapi.json
quarkus.http.auth.permission.openapiq.policy=authenticated

# =========================
# Logging
# =========================
quarkus.log.level=${LOG_LEVEL:INFO}
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%X{requestId}] %c - %s%e%n

# =========================
# Dev services
# =========================
quarkus.datasource.devservices.enabled=false

quarkus.rest.path=/api/v1
quarkus.smallrye-health.root-path=/health
